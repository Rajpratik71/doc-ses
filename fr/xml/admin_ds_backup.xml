<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="admin_ds_backup.xml" version="5.0" xml:id="cha-deployment-backup">
 <title>Sauvegarde de la configuration de la grappe</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer>tbazant@suse.com</dm:maintainer>
        <dm:status>modification</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>oui</dm:translation>
        <dm:languages/>
        <dm:release>SES 5</dm:release>
      </dm:docmanager>
    </info>
    <para>
  Ce chapitre présente les fichiers du noeud admin qui doivent être sauvegardés. Dès que vous avez terminé le déploiement ou la migration de votre grappe, créez une sauvegarde de ces répertoires.
 </para>
 <sect1 xml:id="sec-deployment-backup-salt">
  <title>Sauvegarde de la configuration Salt</title>

  <para>
   Le répertoire <filename>/etc/salt/</filename> peut être sauvegardé. Il contient les fichiers de configuration Salt, par exemple la clé de Salt Master et les clés clients acceptées.
  </para>

  <para>
   Les fichiers Salt ne sont pas strictement requis pour la sauvegarde du noeud admin, mais facilitent le redéploiement de la grappe Salt. S'il n'existe pas de sauvegarde de ces fichiers, les minions Salt doivent être enregistrés à nouveau au niveau du nouveau noeud admin.
  </para>

  <note>
   <title>sécurité de la clé privée de Salt Master</title>
   <para>
    Assurez-vous que la sauvegarde de la clé privée de Salt Master est stockée à un emplacement sûr. La clé de Salt Master peut être utilisée pour manipuler tous les noeuds de la grappe.
   </para>
  </note>

  <para>
   Après avoir restauré le répertoire <filename>salt/etc/</filename> à partir d'une sauvegarde, redémarrez les services Salt :
  </para>

<screen><prompt>root@master # </prompt><command>systemctl</command> restart salt-master
<prompt>root@master # </prompt><command>systemctl</command> restart salt-minion</screen>
 </sect1>
 <sect1 xml:id="sec-deployment-backup-deepsea">
  <title>Sauvegarde de la configuration DeepSea</title>

  <para>
   Tous les fichiers requis par DeepSea sont stockés dans <filename>/srv/pillar</filename>, <filename>/srv/salt/</filename> et <filename>/etc/salt/master.d</filename>.
  </para>

  <para>
   Si vous avez besoin de redéployer le noeud admin, installez le paquetage DeepSea sur le nouveau noeud et replacez les données sauvegardées dans les répertoires. DeepSea peut ensuite être réutilisé sans qu'aucune modification ne soit nécessaire. Avant d'utiliser à nouveau DeepSea, assurez-vous que tous les minions Salt sont correctement enregistrés sur le noeud admin.
  </para>
 </sect1>
</chapter>

<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_admin_ha.xml" version="5.0" xml:id="cha-admin-ha">
 <title>Ceph 管理節點 HA 設定</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:translation>yes</dm:translation>
        <dm:release>SES 5</dm:release>
      </dm:docmanager>
    </info>
    <para>
  <emphasis>Ceph 管理節點</emphasis>是一種執行有 Salt Master 服務的 Ceph 叢集節點。管理節點是 Ceph 叢集的中心點，因為它透過查詢其他叢集節點的 Salt Minion 服務並提供指示，來管理其餘的叢集節點。它通常也會包含其他服務，例如 openATTIC Web UI，由 <emphasis>Prometheus</emphasis> 監控工具套件對 <emphasis>Grafana</emphasis> 儀表板提供支援。
 </para>
 <para>
  如果 Ceph 管理節點發生故障，通常需要為該節點提供新的工作硬體，並透過最近的備份還原完整的叢集組態堆疊。此類方法很費時，並會導致叢集故障。
 </para>
 <para>
  為防止出現由於管理節點故障而導致的 Ceph 叢集效能下降，建議您為 Ceph 管理節點使用高可用性 (HA) 叢集。
 </para>
 <sect1 xml:id="admin-ha-architecture">
  <title>Ceph 管理節點的 HA 叢集概述</title>

  <para>
   HA 叢集的原理是當其中一個叢集節點發生故障時，由另一個節點自動接管其角色，包括虛擬化 Ceph 管理節點。使用此方法時，其他 Ceph 叢集節點不會注意到 Ceph 管理節點發生故障。
  </para>

  <para>
   Ceph 管理節點的最低 HA 解決方案需要以下硬體︰
  </para>

  <itemizedlist>
   <listitem>
    <para>
     能夠執行具有高可用性延伸的 SUSE Linux Enterprise 以及虛擬化 Ceph 管理節點的兩部裸機伺服器。
    </para>
   </listitem>
   <listitem>
    <para>
     兩個或多個備援網路通訊路徑，例如透過網路裝置結合。
    </para>
   </listitem>
   <listitem>
    <para>
     用於代管 Ceph 管理節點虛擬機器的磁碟影像的共用儲存。需要可透過這兩部伺服器存取的共用儲存。例如，該共用儲存可以是 NFS 輸出、Samba 共用或 iSCSI 目標。
    </para>
   </listitem>
  </itemizedlist>

  <para>
   如需叢集要求的更多詳細資料，請存取 <link xlink:href="https://www.suse.com/documentation/sle-ha-12/install-quick/data/install-quick.html#sec_ha_inst_quick_req"/>。
  </para>

  <figure>
   <title>Ceph 管理節點的雙節點 HA 叢集</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="admin-ha-cluster">
  <title>構建用於 Ceph 管理節點的 HA 叢集</title>

  <para>
   以下程序概述了為虛擬化 Ceph 管理節點而構建 HA 叢集的幾個最重要步驟。如需詳細資料，請參閱指定連結。
  </para>

  <procedure>
   <step>
    <para>
     設定一個具有共用儲存的基本雙節點 HA 叢集，如 <link xlink:href="https://www.suse.com/documentation/sle-ha-12/install-quick/data/install-quick.html"/> 中所述。
    </para>
   </step>
   <step>
    <para>
     在兩個叢集節點上，安裝執行 KVM 監管程式和 <systemitem class="library">libvirt</systemitem> 工具套件所需的所有套件，如 <link xlink:href="https://www.suse.com/documentation/sles-12/book_virt/data/sec_vt_installation_kvm.html"/> 中所述。
    </para>
   </step>
   <step>
    <para>
     在第一個叢集節點上，使用 <systemitem class="library">libvirt</systemitem> 建立新的 KVM 虛擬機器 (VM)，如 <link xlink:href="https://www.suse.com/documentation/sles-12/book_virt/data/sec_libvirt_inst_vmm.html"/> 中所述。使用預先設定的共用儲存來儲存虛擬機器的磁碟影像。
    </para>
   </step>
   <step>
    <para>
     虛擬機器設定完成後，將其組態輸出至共用儲存上的 XML 檔案。使用以下語法︰
    </para>
<screen>
<prompt>root # </prompt>virsh dumpxml <replaceable>VM_NAME</replaceable> &gt; /path/to/shared/vm_name.xml
</screen>
   </step>
   <step>
    <para>
     為 Ceph 管理節點虛擬機器建立資源。如需建立 HA 資源的一般資訊，請參閱 <link xlink:href="https://www.suse.com/documentation/sle-ha-12/book_sleha/data/cha_conf_hawk2.html"/>。<link xlink:href="http://www.linux-ha.org/wiki/VirtualDomain_%28resource_agent%29"/> 中提供了如何為 KVM 虛擬機器建立資源的詳細資訊。
    </para>
   </step>
   <step>
    <para>
     在新建立的虛擬機器客體中，部署 Ceph 管理節點，包括您需要在其上使用的其他服務。執行<xref linkend="ceph-install-stack"/>中的相關步驟。同時，在非 HA 叢集伺服器上部署其餘 Ceph 叢集節點。
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>

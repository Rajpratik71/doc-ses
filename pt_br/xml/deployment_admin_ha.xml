<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="deployment_admin_ha.xml" version="5.0" xml:id="cha-admin-ha">
 <title>Configuração de alta disponibilidade do nó de admin do Ceph</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:translation>sim</dm:translation>
        <dm:release>SES 5</dm:release>
      </dm:docmanager>
    </info>
    <para>
  O <emphasis>nó de admin do Ceph</emphasis> é um nó de cluster do Ceph em que o serviço master Salt está sendo executado. O nó de admin é um ponto central do cluster do Ceph porque ele gerencia o restante dos nós de cluster consultando e instruindo os serviços de minion Salt. Normalmente, ele também inclui outros serviços. Por exemplo, a IU da Web do openATTIC com o painel do <emphasis>Grafana</emphasis> e o suporte do kit de ferramentas de monitoramento do <emphasis>Prometheus</emphasis>.
 </para>
 <para>
  Em caso de falha no nó de admin do Ceph, geralmente você precisa fornecer um novo hardware ativo para o nó e restaurar a pilha completa de configuração do cluster de um backup recente. Esse método é demorado e provoca interrupção no cluster.
 </para>
 <para>
  Para evitar o tempo de espera no desempenho do cluster do Ceph causado pela falha no nó de admin, é recomendável usar o cluster de HA (High Availability – Alta Disponibilidade) para o nó de admin do Ceph.
 </para>
 <sect1 xml:id="admin-ha-architecture">
  <title>Estrutura do cluster de HA para o nó de admin do Ceph</title>

  <para>
   A ideia de um cluster de HA é que, em caso de falha em um nó de cluster, o outro nó assume automaticamente sua função, incluindo o nó de admin do Ceph virtualizado. Dessa forma, os outros nós de cluster do Ceph não percebem a falha no nó de admin do Ceph.
  </para>

  <para>
   A solução de HA mínima para o nó de admin do Ceph requer o seguinte hardware:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Dois servidores completamente vazios capazes de executar o SUSE Linux Enterprise com a extensão de Alta Disponibilidade e de virtualizar o nó de admin do Ceph.
    </para>
   </listitem>
   <listitem>
    <para>
     Dois ou mais caminhos de comunicação de rede redundantes. Por exemplo, via Ligação de Dispositivo de Rede.
    </para>
   </listitem>
   <listitem>
    <para>
     Armazenamento compartilhado para hospedar a(s) imagem(ns) de disco da máquina virtual do nó de admin do Ceph. O armazenamento compartilhado precisa ser acessível aos dois servidores. Por exemplo, ele pode ser uma exportação NFS, um compartilhamento Samba ou um destino iSCSI.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Encontre mais detalhes sobre os requisitos de cluster em <link xlink:href="https://www.suse.com/documentation/sle-ha-12/install-quick/data/install-quick.html#sec_ha_inst_quick_req"/>.
  </para>

  <figure>
   <title>Cluster de HA de 2 nós para o nó de admin do Ceph</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ceph_admin_ha1.png" width="60%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="admin-ha-cluster">
  <title>Criando o cluster de HA com nó de admin do Ceph</title>

  <para>
   O procedimento a seguir resume as etapas mais importantes de criação do cluster de HA para virtualização do nó de admin do Ceph. Para obter detalhes, consulte os links indicados.
  </para>

  <procedure>
   <step>
    <para>
     Configure um cluster de HA básico de 2 nós com armazenamento compartilhado, conforme descrito em <link xlink:href="https://www.suse.com/documentation/sle-ha-12/install-quick/data/install-quick.html"/>.
    </para>
   </step>
   <step>
    <para>
     Em ambos os nós do cluster, instale todos os pacotes necessários para executar o hipervisor KVM e o kit de ferramentas <systemitem class="library">libvirt</systemitem>, conforme descrito em <link xlink:href="https://www.suse.com/documentation/sles-12/book_virt/data/sec_vt_installation_kvm.html"/>.
    </para>
   </step>
   <step>
    <para>
     No primeiro nó do cluster, crie uma nova VM (Virtual Machine – Máquina Virtual) KVM usando o <systemitem class="library">libvirt</systemitem>, conforme descrito em <link xlink:href="https://www.suse.com/documentation/sles-12/book_virt/data/sec_libvirt_inst_vmm.html"/>. Use o armazenamento compartilhado pré-configurado para armazenar as imagens de disco da VM.
    </para>
   </step>
   <step>
    <para>
     Após o término da configuração da VM, exporte sua configuração para um arquivo XML no armazenamento compartilhado. Use a seguinte sintaxe:
    </para>
<screen>
<prompt>root # </prompt>virsh dumpxml <replaceable>VM_NAME</replaceable> &gt; /path/to/shared/vm_name.xml
</screen>
   </step>
   <step>
    <para>
     Crie um recurso para a VM do nó de admin do Ceph. Consulte <link xlink:href="https://www.suse.com/documentation/sle-ha-12/book_sleha/data/cha_conf_hawk2.html"/> para obter informações gerais sobre a criação de recursos de HA. Há informações detalhadas sobre a criação de recursos para uma máquina virtual KVM em <link xlink:href="http://www.linux-ha.org/wiki/VirtualDomain_%28resource_agent%29"/>.
    </para>
   </step>
   <step>
    <para>
     No convidado da VM recém-criado, implante o nó de admin do Ceph, incluindo os serviços adicionais necessários nele. Siga as etapas relevantes na <xref linkend="ceph-install-stack"/>. Ao mesmo tempo, implante os nós de cluster do Ceph restantes nos servidores de cluster não HA.
    </para>
   </step>
  </procedure>
 </sect1>
</chapter>

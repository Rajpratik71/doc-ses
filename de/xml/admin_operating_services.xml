<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="admin_operating_services.xml" version="5.0" xml:id="ceph-operating-services">
 <title>Ausführen von Ceph Services</title>
 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:translation>Ja</dm:translation>
        <dm:release>SES 5</dm:release>
      </dm:docmanager>
    </info>
    <para>
  Ceph Services werden entweder mit <systemitem class="daemon">systemd</systemitem> oder mit DeepSea ausgeführt.
 </para>
 <sect1 xml:id="operate-services-systemd">
  <title>Ausführen von Ceph Services mit <systemitem class="daemon">systemd</systemitem></title>

  <para>
   Mit dem Kommando <command>systemctl</command> lassen sich alle Services im Umfeld von Ceph ausführen. Sie werden in dem Node ausgeführt, in dem Sie zurzeit angemeldet sind. Zur Durchführung von Vorgängen bezüglich Ceph Services benötigen Sie <systemitem class="username">root</systemitem>-Berechtigungen.
  </para>

  <sect2 xml:id="ceph-operating-services-targets">
   <title>Starten, Stoppen und Neustarten von Services anhand von Targets</title>
   <para>
    Zur Vereinfachung des Start-, Stopp- und Neustartvorgangs aller Services eines bestimmten Typs (beispielsweise alle Ceph Services, alle MONs oder alle OSDs) in einem Node bietet Ceph die folgenden Dateien für die <systemitem class="daemon">systemd</systemitem>-Einheit:
   </para>
<screen><prompt>root # </prompt> ls /usr/lib/systemd/system/ceph*.target
ceph.target
ceph-osd.target
ceph-mon.target
ceph-mgr.target
ceph-mds.target
ceph-radosgw.target
ceph-rbd-mirror.target</screen>
   <para>
    Führen Sie zum Starten, Stoppen oder Neustarten von Ceph Services folgendes Kommando aus:
   </para>
<screen><prompt>root # </prompt>systemctl stop ceph.target
<prompt>root # </prompt>systemctl start ceph.target
<prompt>root # </prompt>systemctl restart ceph.target</screen>
   <para>
    Führen Sie zum Starten, Stoppen oder Neustarten aller OSDs im Node folgendes Kommando aus:
   </para>
<screen><prompt>root # </prompt>systemctl stop ceph-osd.target
<prompt>root # </prompt>systemctl start ceph-osd.target
<prompt>root # </prompt>systemctl restart ceph-osd.target</screen>
   <para>
    Die Kommandos für die anderen Targets sind entsprechend.
   </para>
  </sect2>

  <sect2 xml:id="ceph-operating-services-individual">
   <title>Starten, Stoppen und Neustarten einzelner Services</title>
   <para>
    Einzelne Services führen Sie anhand der folgenden parametrisierten Dateien für die <systemitem class="daemon">systemd</systemitem>-Einheit aus:
   </para>
<screen>ceph-osd@.service
ceph-mon@.service
ceph-mds@.service
ceph-radosgw@.service
ceph-rbd-mirror@.service</screen>
   <para>
    Für diese Kommandos müssen Sie zunächst den Namen des auszuführenden Service identifizieren. In <xref linkend="ceph-operating-services-finding-names"/> erfahren Sie mehr zur Identifizierung von Services.
   </para>
   <para>
    Führen Sie zum Starten/Stoppen/Neustarten des <literal>osd.1</literal>-Service folgendes Kommando aus:
   </para>
<screen><prompt>root # </prompt>systemctl stop ceph-osd@1.service
<prompt>root # </prompt>systemctl start ceph-osd@1.service
<prompt>root # </prompt>systemctl restart ceph-osd@1.service</screen>
   <para>
    Die Kommandos für die anderen Servicetypen sind entsprechend.
   </para>
  </sect2>

  <sect2 xml:id="ceph-operating-services-finding-names">
   <title>Identifizieren einzelner Services</title>
   <para>
    Die Namen/Nummern bestimmter Servicetypen finden Sie durch Ausführen des Kommandos <command>systemctl</command> und Filtern der Ergebnisse mit dem Kommando <command>grep</command>. Beispiel:
   </para>
<screen><prompt>root # </prompt>systemctl | grep -i 'ceph-osd.*service'
<prompt>root # </prompt>systemctl | grep -i 'ceph-mon.*service'
[...]</screen>
  </sect2>

  <sect2 xml:id="ceph-operating-services-status">
   <title>Service-Status</title>
   <para>
    Eine Abfrage mit <systemitem class="daemon">systemd</systemitem> ermittelt den Status von Services. Beispiel:
   </para>
<screen><prompt>root # </prompt>systemctl status ceph-osd@1.service
<prompt>root # </prompt>systemctl status ceph-mon@<replaceable>HOSTNAME</replaceable>.service</screen>
   <para>
    Ersetzen Sie <replaceable>HOSTNAME</replaceable> durch den Namen des Hosts, auf dem der Daemon ausgeführt wird.
   </para>
   <para>
    In <xref linkend="ceph-operating-services-finding-names"/> finden Sie weitere Informationen, falls Sie den genauen Namen bzw. die Nummer des Service nicht kennen.
   </para>
  </sect2>
 </sect1>
 <sect1 xml:id="Deepsea-restart">
  <title>Neustarten von Ceph Services mit DeepSea</title>

  <para>
   Nach dem Anwenden von Updates in den Cluster Nodes müssen Sie die zugewiesenen Services neu starten, um die kürzlich installierte Version nutzen zu können.
  </para>

  <note>
   <title>Beobachten des Neustarts</title>
   <para>
    Der Vorgang zum Neustarten des Clusters kann einige Zeit dauern. Sie können die Ereignisse mit dem Salt-Ereignisbus beobachtet. Führen Sie dazu folgendes Kommando aus:
   </para>
<screen><prompt>root@master # </prompt>salt-run state.event pretty=True</screen>
  </note>

  <sect2 xml:id="deepsea-restart-all">
   <title>Neustarten aller Services</title>
   <para>
    Führen Sie zum Neustarten <emphasis>aller</emphasis> Services am Cluster das folgende Kommando aus:
   </para>
<screen><prompt>root@master # </prompt>salt-run state.orch ceph.restart</screen>
   <para>
    Die Reihenfolge, in der die einzelnen Rollen neu starten, ist je nach DeepSea-Version (<command>rpm -q deepsea</command>) anders:
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Bei DeepSea-Versionen, die älter sind als Version 0.8.4 wird ein Neustart der Services Metadata Server, iSCSI Gateway, Object Gateway und NFS Ganesha gleichzeitig ausgeführt.
     </para>
    </listitem>
    <listitem>
     <para>
      Bei DeepSea ab Version 0.8.4 werden alle konfigurierten Rollen in der folgenden Reihenfolge neu gestartet: Ceph Monitor, Ceph Manager, Ceph OSD, Metadata Server, Object Gateway, iSCSI Gateway, NFS Ganesha. Nodes werden nacheinander neu gestartet, um die Ausfallzeit so kurz wie möglich zu halten und potenzielle Probleme möglichst früh zu erkennen. Beispielsweise wird nur jeweils ein Monitor Node neu gestartet.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    Das Kommando wartet auf die Wiederherstellung des Clusters, wenn sich der Cluster in einem qualitativ schlechten, fehlerhaften Zustand befindet.
   </para>
  </sect2>

  <sect2 xml:id="deepsea-restart-specific">
   <title>Neustarten bestimmter Services</title>
   <para>
    Führen Sie zum Neustarten eines bestimmten Service im Cluster folgendes Kommando aus:
   </para>
<screen><prompt>root@master # </prompt>salt-run state.orch ceph.restart.<replaceable>service_name</replaceable></screen>
   <para>
    Beispiel: Führen Sie zum Neustarten aller Object Gateways folgendes Kommando aus:
   </para>
<screen><prompt>root@master # </prompt>salt-run state.orch ceph.restart.rgw</screen>
   <para>
    Sie können die folgenden Targets verwenden:
   </para>
<screen><prompt>root@master # </prompt>salt-run state.orch ceph.restart.mon</screen>
<screen><prompt>root@master # </prompt>salt-run state.orch ceph.restart.mgr</screen>
<screen><prompt>root@master # </prompt>salt-run state.orch ceph.restart.osd</screen>
<screen><prompt>root@master # </prompt>salt-run state.orch ceph.restart.mds</screen>
<screen><prompt>root@master # </prompt>salt-run state.orch ceph.restart.rgw</screen>
<screen><prompt>root@master # </prompt>salt-run state.orch ceph.restart.igw</screen>
<screen><prompt>root@master # </prompt>salt-run state.orch ceph.restart.ganesha</screen>
  </sect2>
 </sect1>
</chapter>
